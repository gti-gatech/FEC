<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="HandheldFriendly" content="true">
<title>Fuel Emission Online Calculator</title>

<script src="http://ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/numeral.js/1.4.5/numeral.min.js"></script>
<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
<script type="text/javaScript" src="//d3js.org/d3.v3.min.js"></script>
<style>


legend {
	font-size: 24px;
	background-color: #a3c2c2;
	color: black;
	text-align: center;
	width: 100%;
	padding: 3px;
}

label {
font-weight:bold;
}

 th {
    border: 1px solid black;
	background-color: #ffffb3;
	text-align: center;
}
td {
    display: table-cell;
    vertical-align: inherit;
	text-align: center;
}

.button{
	float:center;
	width: 200px;
	height: 30px;
	font: bold 18px "Helvetica Neue", Helvetica, Arial, clean, sans-serif !important;
	border-radius: 5px;
	-moz-border-radius: 5px;
	-webkit-border-radius: 5px;
	-moz-box-shadow: 0 1px 2px rgba(0,0,0,0.5);
	-webkit-box-shadow: 0 1px 2px rgba(0,0,0,0.5);
	display: inline-block;
	color: black;
	padding: 5px 10px 5px;
	white-space: nowrap;
	text-decoration: none;
	cursor: pointer;
	background: #a3c2c2; 
	border-style: none;
	text-align: center;
	overflow: visible;
	margin-top: 30px;
	margin-bottom: 20px;
	margin-left: 30px;
}
.bar {
  fill: steelblue;
}

.bar:hover {
  fill: brown;
}

.axis {
  font: 10px sans-serif;
}

.axis path,
.axis line {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
}

.x.axis path {
  display: none;
}

.chart rect {
    fill: steelblue;
  }
rect:hover {
	fill: #00ffff;
}

.container {
  position: relative;
}
.uploadButton {
  height: 25px;
  width: 66px;
  display: block;
  cursor: pointer;
  background: url('http://www.ifunia.com/images/christmas/youtube-upload-button.gif') left left no-repeat;
}


</style>


</head>
<body>
<h2 align="center">Fuel Emission Calculator Input</h2>
<section>
    
		<legend>Scenario</legend>
		<br>
		<table style="width:70%; height:40%; font-weight:bold;" align="center" cellpadding="0">
		<tr>
		<td>
        <label title= "please select the city">
            City:
		</label>
		</td>
		<td>
        <select id="city" style="min-width:138px; max-width:138px;"></select>
		</td>
		<td>
        <label>
            State:
		</label>
		</td>
		<td>
        <select id="state" style="min-width:138px; max-width:138px;"></select>
        </td>
		<td>
		   <label title = "please select a season">
            Season Scenario:
			</label>
			</td>
			<td>
            <select id="season_scenario" style="min-width:138px; max-width:138px;">
                <option id="season_summer">Summer</option>
                <option id="season_winter">Winter</option>
            </select>
		</td>
		<td>
		<label>
            Severity Index:
		</label>
		</td>
		<td>
            <select title = "severity is ranked from 1 (least severe) to 6 (most severe)" id="severity_index" style="min-width:138px; max-width:138px;">
                <option>1</option>
                <option>2</option>
                <option>3</option>
                <option>4</option>
                <option>5</option>
                <option>6</option>
            </select>
        
		</td>
        </tr>
		<tr>
		<td><br></td>
		</tr>
        <tr>
		
		<td>
		    <label title= "please choose a calendar year">
            Inventory <br>Year:
			</label>
			</td>
			<td>
            <select id="inventory_year" style="min-width:138px; max-width:138px;">
                <option>2015</option>
                <option>2016</option>
                <option>2017</option>
				<option>2018</option>
                <option>2019</option>
                <option>2020</option>
				<option>2021</option>
                <option>2022</option>
                <option>2023</option>
                <option>2024</option>
                <option>2025</option>				
            </select>
		</td>
		
		<td>
		 <label>Number of <br> Runs/Bus/Day:
		 </td>
		 <td>
		  <input style="min-width:130px; max-width:130px;" type="text" id="number_of_runs_per_bus_per_day" autocomplete="on" value="10" />
		</td>
		<td>
		 <label>
                Vehicle Classification:
				</label>
				</td>
				<td>
                <select id="vehicle_classification" style="min-width:138px; max-width:138px;">
                    <option value = "Transit Bus">Transit Bus</option>
                    <option value = "Paratransit Van/Shuttle Bus">Paratransit Van/Shuttle Bus</option>
                </select>
		</td>
		
				<td>
		  <label>
            Duty Cycle:
			</label>
			</td>
			<td>
            <select id="duty_cycle" style="min-width:138px; max-width:138px;">
                <option id="custom_input_cycle">Custom_Input</option>
                <option id="hd_udds_cycle" selected="selected">HD-UDDS</option>
                <option id="octa_cycle">OCTA</option>
                <option id="manhattan_cycle">Manhattan</option>
                <option id="nybc_cycle">NYBC</option>
				<option id="nycc_cycle">NYCC</option>
                <option id="wmata_cycle">WMATA</option>
                <option id="paris_cycle">Paris</option>
                <option id="etc_urban_cycle">ETC-Urban</option>
                <option id="sf_cycle">SF</option>
                <option id="kcmc_cycle">KCMC</option>
                <option id="beeline_cycle">Beeline</option>
                <option id="cshvc_cycle">CSHVC</option>
                <option id="cbd_sae_cycle">CBD(SAE)</option>
                <option id="wvu-5PEAK">WVU-5PEAK</option>
            </select>
           
		</td>
		</tr>
        <tr>
		<td><br></td>
		</tr>
		
		<tr>
		
		<td>
		<label>Route Length:</label>
		</td>
		<td>
		<input type="text" value="10" id="route_length" autocomplete="on" style="min-width:130px; max-width:130px;"/>
		</td>
		
		<td>
		<label>Average Passenger <br> Loading per Bus <br> per Run:</label> 
		</td>
		<td>
		<input type="text" value="0" id="average_passenger_loading_per_bus_per_run" autocomplete="on" style="min-width:130px; max-width:130px;"/>
		</td>
		
		<td>
		<label>Number of <br> Runs/Bus/Year: </label>
		</td>
		<td>
		<input type="text" id="number_of_runs_per_bus_per_year" autocomplete="on" value="3650" style="min-width:130px; max-width:130px;"/>
		</td>
		<td>
		<label>Number of Buses: </label>
		</td>
		<td>
		<input type="text" id="number_of_buses" autocomplete="on" value="500" style="min-width:130px; max-width:130px;"/>
		</td>
		
		</tr>
		<tr>
		<td><br></td>
		</tr>
        <tr>
		
		<td>
		<label>Idle Speed<br> Range:</label>
		</td>
		<td>
		<input title = "please provide the speed range for bus idling" type="text" id="idle_speed_range" autocomplete="on" value="1.0" style="min-width:130px; max-width:130px;"/>
		</td>
		
		<!--td>
		<label>Custom<br> Cycle</label>
		</td-->
		<td>
		<!--form action="upload.php" method="post" target="uploadTarget" id="cycleupload" class="container"> 
			<input type="button" style="float:left;" id= "template input" title ="The speed profile with unit mph" value="Template" onClick="window.location.href='CustomInput.csv'">
			<input type="file" style="float:left;" name="file" id="file" required />
		    <button type="submit" style="float:left;" name="submit" id="submit">Submit</button>	
		</form--> 			
		</td>
		
		</tr>


</div>

</table>
</section>



<section>
<br>
<legend>Vehicle/Route Options</legend>
<table style="height:50%;" cellpadding="10" align="center">
<tr>
<td>
<table cellpadding="5">
<h3 style="padding-left:115px; color:#000066;">Conventional Internal Combustion Engine</h3>
<tr>
    <th colspan="2">
	SI/CI
    </th>
	<th colspan="2">
	SI/CI
    </th>
    </tr>
    <tr>
    <td>
	<label>
	Fuel Type
	</label>
	</td>
	<td>
    
	         <select id="fuel_type_1" style="min-width:138px; max-width:138px;">
                <option value = "Gasoline">Gasoline</option>
                <option value = "Conventional Diesel" selected="selected">Conventional Diesel</option>
                <option value = "Compressed Natural Gas(CNG)">Compressed Natural Gas(CNG)</option>
                <option value = "Biodiesel 2">Biodiesel 2</option>
                <option value = "Biodiesel 5">Biodiesel 5</option>
                <option value = "Biodiesel 10">Biodiesel 10</option>
                <option value = "Biodiesel 20">Biodiesel 20</option>
				<option value = "Biodiesel 5">Biodiesel 100</option>				
        </select>
	</td>
	
	<td>
	<label>
	Fuel Type
	</label>
    </td>
	<td>
        <select id="fuel_type_2" style="min-width:138px; max-width:138px;">
                <option value = "Gasoline" selected="selected">Gasoline</option>
                <option value = "Conventional Diesel">Conventional Diesel</option>
                <option value = "Compressed Natural Gas(CNG)">Compressed Natural Gas(CNG)</option>
                <option value = "Biodiesel 2">Biodiesel 2</option>
                <option value = "Biodiesel 5">Biodiesel 5</option>
                <option value = "Biodiesel 10">Biodiesel 10</option>
                <option value = "Biodiesel 20">Biodiesel 20</option>
				<option value = "Biodiesel 5">Biodiesel 100</option>				
        </select>
	</td>
	</tr>
<tr><td><br></td></tr>	
	
<tr>
<td>
<label>Revenue Route</label>
</td>
<td>
        <select id="revenue_route_1" style="min-width:138px; max-width:138px;">
                <option>Yes</option>
                <option>No</option>
        </select>
</td>
<td>
<label>Revenue Route</label>
</td>
<td>
        <select id="revenue_route_2" style="min-width:138px; max-width:138px;">
            <option>Yes</option>
            <option>No</option>
        </select>
</td>
</tr>
</table>
</td>
<!-----------------------------table 2--------------------------->
<td>
<table cellpadding="5">
<h3 style="padding-left:190px; color:#000066;">Hybrid Electric Vehicles</h3>
<tr>
<th colspan="2">Parallel</th>
<th colspan="2">Series</th>
</tr>

<tr>
<td>
<label>Fuel Type</label>
</td>
<td>
        <select id="fuel_type_3" style="min-width:138px; max-width:138px;">
                <option value = "Gasoline">Gasoline</option>
                <option value = "Conventional Diesel" selected="selected">Conventional Diesel</option>
                <option value = "Compressed Natural Gas(CNG)">Compressed Natural Gas(CNG)</option>
                <option value = "Biodiesel 2">Biodiesel 2</option>
                <option value = "Biodiesel 5">Biodiesel 5</option>
                <option value = "Biodiesel 10">Biodiesel 10</option>
                <option value = "Biodiesel 20">Biodiesel 20</option>
				<option value = "Biodiesel 5">Biodiesel 100</option>	
        </select>
</td>

<td>
<label>Fuel Type</label>
</td>
<td>
        <select id="fuel_type_4" style="min-width:138px; max-width:138px;">
                <option value = "Gasoline">Gasoline</option>
                <option value = "Conventional Diesel" selected="selected">Conventional Diesel</option>
                <option value = "Compressed Natural Gas(CNG)">Compressed Natural Gas(CNG)</option>
                <option value = "Biodiesel 2">Biodiesel 2</option>
                <option value = "Biodiesel 5">Biodiesel 5</option>
                <option value = "Biodiesel 10">Biodiesel 10</option>
                <option value = "Biodiesel 20">Biodiesel 20</option>
				<option value = "Biodiesel 5">Biodiesel 100</option>				
        </select>
</td>
</tr>
<tr><td><br></td></tr>
<tr>
<td>
<label>Revenue Route</label>
</td>

<td>
        <select id="revenue_route_3" style="min-width:138px; max-width:138px;">
            <option>Yes</option>
            <option>No</option>
        </select>
</td>
<td>
<label>Revenue Route</label>
</td>
<td>
        <select id="revenue_route_4" style="min-width:138px; max-width:138px;">
            <option>Yes</option>
            <option>No</option>
        </select>
</td>
</tr>

</table>
</td>
</tr>
</table>
<!----------------------------table 3---------->
<table cellpadding="10" align="center">
<tr>
<td>
<table cellpadding="5">
<h3 style="padding-left:200px; color:#000066;">Electric Vehicles</h3>
<tr>
<th colspan="2">Battery Electric (BE)</th>
<th colspan="2">Fuel Cell Electric (FCE)</th>
</tr>

<tr>
<td>
<label>Fuel Type</label>
</td>
<td>
        <select id="fuel_type_5" disabled="true" style="min-width:138px; max-width:138px;">
                <option value = "Gasoline">Gasoline</option>
                <option value = "Conventional Diesel" selected="selected">Electricity</option>
                <option value = "Compressed Natural Gas(CNG)">Compressed Natural Gas(CNG)</option>
                <option value = "Biodiesel 2">Biodiesel 2</option>
                <option value = "Biodiesel 5">Biodiesel 5</option>
                <option value = "Biodiesel 10">Biodiesel 10</option>
                <option value = "Biodiesel 20">Biodiesel 20</option>
				<option value = "Biodiesel 5">Biodiesel 100</option>	
        </select>
</td>
<td>
<label> Fuel Type</label>
</td>
<td>
        <select id="fuel_type_6"  disabled="true" style="min-width:138px; max-width:138px;">
                <option>Gasoline</option>
                <option selected="selected">Hydrogen</option>
                <option>Compressed Natural Gas(CNG)</option>
                <option>Biodiesel 2</option>
                <option>Biodiesel 5</option>
                <option>Biodiesel 10</option>
                <option>Biodiesel 20</option>
				<option>Biodiesel 100</option>
                <option>Electricity</option>

        </select>
</td>
</tr>
<tr><td><br></td></tr>
<tr>
    <td>
       <label> Revenue Route </label>
    </td>
    <td>
        <select id="revenue_route_5" style="min-width:138px; max-width:138px;">
            <option>Yes</option>
            <option>No</option>
        </select>
    </td>
	<td>
	<label>Revenue Route</label>
	</td>
    <td>
        <select id="revenue_route_6" style="min-width:138px; max-width:138px;">
            <option>Yes</option>
            <option>No</option>
        </select>

    </td>
    </tr>
</table>
</td>
<td>
<!---------------------------table 4-------------->
<table cellpadding="5">
<h3 style="padding-left:185px; color:#000066;">Plugin Hybrid Vehicles</h3>
<tr>
<th colspan="2">Plugin Fuel Cell Electric (PFCE)</th>
<th colspan="2">Plug-in Hybrid Electric (PHE)</th>
</tr>
<tr>
    <td>
      <label>Fuel Type</label>
    </td>
    <td>
        <select id="fuel_type_7" disabled="true" style="min-width:138px; max-width:138px;">
                <option>Gasoline</option>
                <option selected="selected">Hydrogen</option>
                <option>Compressed Natural Gas(CNG)</option>
                <option>Biodiesel 2</option>
                <option>Biodiesel 5</option>
                <option>Biodiesel 10</option>
                <option>Biodiesel 20</option>
				<option>Biodiesel 100</option>				
                <option>Electricity</option>
        </select>
    </td>
	<td>
	<label>Fuel Type</label>
	</td>
    <td>
        <input type = "text" id="fuel_type_8" value = "Conventional Diesel" style="min-width:138px; max-width:138px;"/>
    </td>
</tr>
<tr><td><br></td></tr>
<tr>
    <td>
       <label> Revenue Route </label>
    </td>

    <td>
        <select id="revenue_route_7" style="min-width:138px; max-width:138px;">
            <option>Yes</option>
            <option>No</option>
        </select>
    </td>
	<td>
	<label> Revenue Route</label>
	</td>
    <td>
        <select id="revenue_route_8" style="min-width:138px; max-width:138px;">
            <option>Yes</option>
            <option>No</option>
        </select>
    </td>
</tr>

    
</table>
</td>
</tr>
</table>

</section>

<section id="choose pollutant">
<br>
<legend>Data Display Options</legend>
<table style="height:50%;" cellpadding="10" align="center">
<tr>
<td>
<table cellpadding="5">
<h3 style="padding-left:115px; color:#000066;">Pollutant for Plot</h3>

    <tr>
    <td>
	<label>
	Pollutant type
	</label>
	</td>
	<td>
    
	         <select id="pollutant_plot" style="min-width:138px; max-width:138px;">
                <option selected="selected">Atmospheric CO2</option>
                <option>Methane (CH4)</option>
                <option>Nitrous Oxide(N2O)</option>
                <option>Primary PM2.5 - Elemental Carbon</option>
                <option>CO2 Equivalent</option>
                <option>Carbon Monoxide(CO)</option>
                <option>Volatile Organic Compounds</option>
				<option>Oxides of Nitrogen(NOx)</option>
				<option>Primary Exhaust PM2.5 - Total</option>
				<option>Primary Exhaust PM10 - Total</option>
				<option>Sulphur Dioxide (SO2)</option>
        </select>
	</td>
	</tr>
	

<tr><td><br></td></tr>	
	
</table>

</td>
</tr>
</table>



</section>


<section>
<div id="submit_button" data-role="button" align="center">
<button class="button" type="button">Fetch Results</button>
<div class="loading" style="display:none" id="loading"><img src="images/ajax-loader.gif" class="displayed"/><br>Computation may take up to 60 seconds</div>
</div>

        

<h1>Fuel Emission Calculator Output</h1>
<div id="outputs_section" >
    
    <div id = "energy_consumption_table">
    </div>
	<br>
	
	<div id = "energy_consumption_plot">
    </div>
	<br>
	
    <div id = "upstream_emissions">
    </div>
	<br>	
	
	<div id = "upstream_emissions_plot">
    </div>
	<br>
	
    <div id = "onroad_emissions">
    </div>
	<br>  

	<div id = "onroad_emissions_plot">
    </div>
	<br>	
	
    <div id = "emissions_output_total">
    </div>
	<br>

	<div id = "emissions_output_plot">
    </div>
	<br>
	
    <div id = "annual_total_emissions">
    </div>

	<div id = "annual_total_plot">
    </div>
	<br>	
	

</div>

</section>

</body>


<script type="text/JavaScript">
    //get a reference to the select element


	
    var $select = $('#city');
    var $state = $("#state");
    var $severity_index = $("#severity_index");
    var $inventory_year = $('#inventory_year');
	var $pollutant_dis = $('#pollutant_plot');
    
    window.temp_global = null;
    

    fuel_type_name_to_id_map = {
         "Gasoline" : 1,
         "Conventional Diesel" : 2,
         "Hydrogen" : 0,
         "Compressed Natural Gas(CNG)" : 3,
         "Liquefied Petroleum Gas(LPG)" : 4,
         "Liquefied Natural Gas(LNG)" : 200,
         "Biodiesel 2" : 202,
         "Biodiesel 5" : 205,
         "Biodiesel 10" : 210,
         "Biodiesel 20" : 220,
		 "Biodiesel 100" : 2100,
         "Electricity" : 9
    };
    
    emission_name_to_index_map = {
        "Atmospheric CO2" : 1, 
        "CO2 Equivalent" : 2,
        "Carbon Monoxide(CO)" : 3,
        "Methane (CH4)" : 4, 
        "Nitrous Oxide(N2O)" : 5,
        "Oxides of Nitrogen(NOx)" : 6,
        "Primary Exhaust PM2.5 - Total" : 7,
        "Primary Exhaust PM10 - Total" : 8, 
        "Primary PM2.5 - Elemental Carbon" : 9,
        "Sulphur Dioxide (SO2)" : 10,
        "Volatile Organic Compounds" : 11
    }
	
	
    
    //request the JSON data and parse into the select element
    $.ajax({ url: 'read_city.php', dataType: 'json', async: false,
            success: function(data) {
      
                  //clear the current content of the select
                  $select.html('');
             
                  //iterate over the data and append a select option
                  $.each(data, function(key, val){
                        window.city_info = data;
                        $select.append('<option id="' + val[1] + '">' + val[0] + '</option>');
                        $state.append('<option id="' + val[2] + '">' + val[2] + '</option>');
                    })
                  // Select the default city the same as in the Excel
                  $select.val("Knoxville, TN");
                  $state.val("TN");
                  $severity_index.val("4");
                  $inventory_year.val("2015");
                  
            }});
    
    city_state_map = [];
    for(city_no=0;city_no<window.city_info.length;city_no++) {
        //console.log(window.city_info[city_no][0]);
        city_state_map[window.city_info[city_no][0]] = window.city_info[city_no][2];
        //console.log(city_state_map);
    }

    $("#city" ).change(function () {
        var $city = $('#city').val();
        var $state = city_state_map[$city];
        $('#state').val($state);
    });
	
	var form = document.getElementById('cycleupload');
	var fileSelect = document.getElementById('file');
	var uploadButton = document.getElementById('submit');
/*	form.onsubmit = function(event) {
	  event.preventDefault();

	  // Update button text.
	  uploadButton.innerHTML = 'Uploading...';
	  var files = fileSelect.files;
	  var formData = new FormData();
	  for (var i = 0; i < files.length; i++) {
		var file = files[i];
		formData.append('traces', file, "CustomInput.csv");
		}
	    var xhr = new XMLHttpRequest();
		xhr.open('POST', 'sendtrace.php', true);
		xhr.onload = function () {
			if (xhr.status === 200) {
			// File(s) uploaded.
				uploadButton.innerHTML = 'Upload';
			} else {
				alert('An error occurred!');
			}
		};
		xhr.send(formData);
	}*/
	
	$('#vehicle_classification').change(function(e){
	if($(this).val() == 'Paratransit Van/Shuttle Bus'){
		$("#fuel_type_1 option[value='Compressed Natural Gas(CNG)']").prop('disabled',true);
		$("#fuel_type_2 option[value='Compressed Natural Gas(CNG)']").prop('disabled',true);
		$("#fuel_type_3 option[value='Compressed Natural Gas(CNG)']").prop('disabled',true);
		$("#fuel_type_4 option[value='Compressed Natural Gas(CNG)']").prop('disabled',true);
		$("#fuel_type_5 option[value='Compressed Natural Gas(CNG)']").prop('disabled',true);
	}
	else {
		$("#fuel_type_1 option[value='Compressed Natural Gas(CNG)']").prop('disabled',false);
		$("#fuel_type_2 option[value='Compressed Natural Gas(CNG)']").prop('disabled',false);
		$("#fuel_type_3 option[value='Compressed Natural Gas(CNG)']").prop('disabled',false);
		$("#fuel_type_4 option[value='Compressed Natural Gas(CNG)']").prop('disabled',false);
		$("#fuel_type_5 option[value='Compressed Natural Gas(CNG)']").prop('disabled',false);
	}
	});
	/*var x = document.getElementById("file");
	x.disabled = true;
	$('#duty_cycle').change(function(e){
	if($(this).val() == 'Custom_Input'){		    
		x.disabled = false;
	}
	else {
		x.disabled = true;
	}
	});
	*/
	$('#fuel_type_4').change(function(e){
		$("#fuel_type_8").val(e.target.value);
	});

//~ cycle_name = "HD-UDDS"
//~ number_of_passengers = 0
//~ cycle_location = 1
//~ year = 2011
//~ road_type_id = 5
//~ source_type_id = 42
//~ # Fuel type ids and Technology IDs pair 
//~ hours_in_operation = 0.530337825194649
//~ ambient_temperature_degree_f = 87.3
//~ relative_humidity = 53.8
//~ charging_requirement=c.END_OF_RUN
//~ all_electric_range_miles = 5.0
//~ route_length = 10.0
//~ fuel_type_id_ice = 2
//~ fuel_type_id_hybrid_parallel = 2
//~ fuel_type_id_hybrid_series = 2
//~ fuel_type_id_be = 2
//~ fuel_type_id_fce = 0
//~ fuel_type_id_pfce = 0
//~ fuel_type_id_phe = 2
//~ no_of_runs_per_day = 10
//~ power_train_architecture = c.TRAIN_ARCHITECTURE_SERIES

    $("#submit_button").click( function()
           {
              $('#loading').show();
              vehicle_type = $('#vehicle_classification').val();
              if (vehicle_type == 'Transit Bus') {
                  source_type_id = 42;
              } else {
                  source_type_id = 32;
              }

              post_city = $('#city').val();
              post_city = post_city.replace(", ", "_");
			  post_city = post_city.replace(" ", "+");
			  console.log(post_city);
              post_data_dict = { 
                  cycle_name : $('#duty_cycle').val(),
                  number_of_passengers : $('#average_passenger_loading_per_bus_per_run').val(),
                  year : $('#inventory_year').val(),
                  // Road Type ID has not been made an input in the Excel sheet
                  // The cell depends on Road Type like "Urban Restricted" etc 
                  // These cells have been set inivisible in excel so harcoding this 
                  // the value used in Excel i.e. "Urban Restricted"
                  road_type_id : 5,
                  source_type_id : source_type_id,
				  season : $('#season_scenario').val(),
				  severity: $('#severity_index').val(),
                  charging_requirement : "End_of_Run",
                  all_electric_range_miles : 5.0,
                  route_length : $('#route_length').val(),
				  idle_speed_range: $('#idle_speed_range').val(),	
                  fuel_type_id_ice : fuel_type_name_to_id_map[$('#fuel_type_1').val()],
				  fuel_type_id_ice_2 : fuel_type_name_to_id_map[$('#fuel_type_2').val()],
                  fuel_type_id_hybrid_parallel : fuel_type_name_to_id_map[$('#fuel_type_3').val()],
                  fuel_type_id_hybrid_series : fuel_type_name_to_id_map[$('#fuel_type_4').val()],
                  no_of_runs_per_day : $('#number_of_runs_per_bus_per_day').val(),			  
                  power_train_architecture : "Series",
                  fuel_type_id_be : fuel_type_name_to_id_map[$('#fuel_type_5').val()],
                  fuel_type_id_fce : fuel_type_name_to_id_map[$('#fuel_type_6').val()],
                  fuel_type_id_pfce : fuel_type_name_to_id_map[$('#fuel_type_7').val()],
                  fuel_type_id_phe : fuel_type_name_to_id_map[$('#fuel_type_8').val()],
                  number_of_runs_per_bus_per_year : $('#number_of_runs_per_bus_per_year').val(),
                  number_of_buses : $('#number_of_buses').val(),
                  city : post_city,
            }
            console.log(post_data_dict);
             $.post( "python_code/call_python.php", post_data_dict)
                .done(function( data ) {
                    $('#loading').hide();
                    console.log(data);
                    window.temp_global = data;
                    var json_data = $.parseJSON(data);
					var pollutant_dis = $('#pollutant_plot').val();
					var pollutant_p = pollutant_dis.toString();
                    window.temp_global = json_data;
                    
					console.log(pollutant_p)
                    var header_tag_energy =     '<table border="1"><caption><b>Energy Consumption Rate (Kwh)</b></caption>' +
                                                '<tr>' +
												'<td>SI/CI</td>' +
												'<td>SI/CI</td>' +
                                                '<td>Parallel</td>' +
                                                '<td>Series</td>' +
                                                '<td>Battery Electric(BE)</td>' +
                                                '<td>Fuel Cell Electric(FCE)</td>' +
                                                '<td>Plug-in Fuel Cell Electric(PFCE)</td>' +
                                                '<td>Plug-in Hybrid Electric(PHE)</td>'  +
                                                '</tr>' +
                                                    
                                                '<tr>' +
                                                '<td class="number" id="energy_value_1"></td>' +
                                                '<td class="number" id="energy_value_2"></td>' +
                                                '<td class="number" id="energy_value_3"></td>' +
                                                '<td class="number" id="energy_value_4"></td>' +
                                                '<td class="number" id="energy_value_5"></td>' +
                                                '<td class="number" id="energy_value_6"></td>' +
                                                '<td class="number" id="energy_value_7"></td>' +   
												'<td class="number" id="energy_value_8"></td>' +  
                                                '</tr></table>';
                                                
                    $("#energy_consumption_table").html(header_tag_energy);
					var btn = document.createElement("BUTTON");
					var t = document.createTextNode("expand table");
					btn.id = "expand"
					btn.appendChild(t);

                    var energy = [];
					var energy_id = [];
                    var tech_ids = Object.keys(json_data["energy_values"]);
                    for (var tech_id_no in tech_ids) {
                        tech_id = tech_ids[tech_id_no];
						energy_id.push(tech_id);
                        // Apparently we need to use html to set value for td, val wouldn't do <facepalm>
                        $("#energy_value_" + tech_id).html(numeral(json_data["energy_values"][tech_id]).format('0.00'));
						energy.push(parseFloat(numeral(json_data["energy_values"][tech_id]).format('0.00')))
                            
                    }
					/*
					document.energy_consumption_table.appendChild(btn);
					$('#expand').click(function(){
						  // see if they are all shown
						  var children = $('#table1 tr.b').length;
						  var visibleChildren = $('#table1 tr.b:visible').length;
						  if(children == visibleChildren) { // all the trs are shown
							$('#table1 tr.b').hide(); // hide all b rows
						  }
						  else {
							$('#table1 tr.b').show(); // shows all
						  }
						});
					*/


					
					<!---ENERGY CONSUMPTION D3 PLOT START--->
					//d3.selectAll("svg > *").remove();
					d3.select("svg").remove();
					d3.select("svg2").remove();
					d3.select("svg3").remove();
					d3.select("svg4").remove();

					var w = 500;
					var h = 300;
					var barPadding = 5;
					var margin=100;
					var dmax=Math.max.apply(Math, energy);
					var scaley=h/dmax;
	
	
					//Create SVG element
					var svg = d3.select("#energy_consumption_plot")
								.append("svg")
								.attr("width", w + margin*2)
								.attr("height", h + margin*2);
					
					var widthScale = d3.scale.linear()
						.domain([0, energy.length])
						.range([0, w]);
						
					var heightScale = d3.scale.linear()
						.domain([0,dmax ])
						.range([h,0]);
						
					var xAxis = d3.svg.axis()
						.scale(widthScale)
						.orient("bottom");
						
					var yAxis = d3.svg.axis()
						.scale(heightScale)
						.orient("left")
						.ticks(5);
					
					// make bars
					svg.selectAll("rect")
						.data(energy)
						.enter()
						.append("rect")
						.attr("class", "rect")
						.attr("fill", "teal")
						.attr("x", function(d, i) {
							return margin + i * (w / energy.length);
						})
						.attr("y", function(d) {
							return h + margin - (d * scaley);
						})
						.attr("width", w / energy.length - barPadding)
						.attr("height", function(d) {
							return d * scaley;
						});
					
					// text above bars
					svg.selectAll("text")
						.data(energy)
						.enter()
						.append("text")
						.text(function(d) {return d;})
						.attr("x", function(d, i) {
							return margin+ (i+.1) * (w / energy.length);
						})
						.attr("y", function(d) {
							return h + margin - (d * scaley);
						});
				   
					// x axis
					svg.append("g")
						.attr("class", "axis")
						.attr("transform", "translate(" + margin + "," + (h+margin) + ")")
						.call(xAxis);
					
					// y axis
					svg.append("g")
						.attr("class", "axis")
						.attr("transform", "translate(" + margin + "," + (margin) + ")")
						.call(yAxis);
						
					// x label
					svg.append("text")
						.attr("y", h+margin+30)
						.attr("x", w/2)
						.text("Energy consumption by route option (kwh)")
//					Div2.appendChild(svg)
					<!--ENERGY CONSUMPTION D3 DRAWING END-->
		
					

                    var header_tag = 
                           "<table border='1'><caption><b>Upstream Emissions</b></caption>" +
                            "<tr> " + 
							'<td></td>' +
                            "<td> Unit </td>" +
                            "<td> SI/CI </td>" +
                            "<td> SI/CI </td>" +							
                            "<td> Parallel </td>" +
                            "<td> Series </td>" +
                            "<td> Battery Electric(BE) </td>" +
                            "<td> Fuel Cell Electric(FCE) </td>" +
                            "<td> Plug-in Fuel Cell Electric(PFCE) </td>" +
                            "<td> Plug-in Hybrid Electric(PHE) </td>";

                    table_html = header_tag;
                    var pollutant_row_html = {};
                    var json_data_1 = $.parseJSON(json_data["upstream_emissions"]);
                    var tech_ids = Object.keys(json_data_1);
					var display = new Object();
					display.emission = pollutant_p
                    // For now hardcoding the pollutants to a specific order
                    // to match the order of the columns in html table
                    // Ideally the ordering should be decided on a mapping from the
                    // tech id to the techonology name
                    tech_ids = ["unit","1", "2", "3", "4", "5", "6", "7","8"];
					firstRun = true;
					var emission_upstream = [];
                    for (var tech_id_no in tech_ids) {
                        tech_id = tech_ids[tech_id_no];
                        var pollutants = Object.keys(json_data_1[tech_id]);
						//var emunit = json_data_1["unit"];
                        for (var pollutant_no in pollutants) {
                            pollutant = pollutants[pollutant_no];
							//console.log(pollutant)
                            if (!pollutant_row_html[pollutant]) {
                                pollutant_row_html[pollutant] = "<tr><td >" + pollutant + "</td>";
                            }
							if (firstRun) {
								pollutant_row_html[pollutant] += "<td>" +  json_data_1[tech_id][pollutant]  +  "</td>";
								if (pollutant == pollutant_p){
									display.unit = json_data_1[tech_id][pollutant];
								}
						//		console.log('first');
							} else { 
								pollutant_row_html[pollutant] += "<td class='number'>" +  numeral(json_data_1[tech_id][pollutant]).format('0,0.00')  +  "</td>";
								if (pollutant == pollutant_p) {
									emission_upstream.push(parseFloat(numeral(json_data_1[tech_id][pollutant]).format('0,0.00')))
								}
							//	
							}
                           
                        }
						firstRun = false;
                    }
                    for (var pollutant in pollutant_row_html) {
                        table_html += pollutant_row_html[pollutant] + "</tr>";
                    }
                    table_html += "</table>";
                    //console.log(table_html);
					
					$("#upstream_emissions").html(table_html);

					<!----atmospheric emission plot-->
					var w2 = 500;
					var h2 = 300;
					var barPadding2 = 5;
					var margin2=100;
					var dmax2=Math.max.apply(Math, emission_upstream);
					var scaley2=h2/dmax2;
	
	
					//Create SVG element
					var svg2 = d3.select("#upstream_emissions_plot")
								.append("svg")
								.attr("width", w2 + margin2*2)
								.attr("height", h2 + margin2*2);
					
					var widthScale2 = d3.scale.linear()
						.domain([0, emission_upstream.length])
						.range([0, w2]);
						
					var heightScale2 = d3.scale.linear()
						.domain([0,dmax2 ])
						.range([h2,0]);
						
					var xAxis2 = d3.svg.axis()
						.scale(widthScale2)
						.orient("bottom");
						
					var yAxis2 = d3.svg.axis()
						.scale(heightScale2)
						.orient("left")
						.ticks(5);
					
					// make bars
					svg2.selectAll("rect")
						.data(emission_upstream)
						.enter()
						.append("rect")
						.attr("class", "rect")
						.attr("fill", "teal")
						.attr("x", function(d, i) {
							return margin2 + i * (w2 / emission_upstream.length);
						})
						.attr("y", function(d) {
							return h2 + margin2 - (d * scaley2);
						})
						.attr("width", w2 / emission_upstream.length - barPadding2)
						.attr("height", function(d) {
							return d * scaley2;
						});
					
					// text above bars
					svg2.selectAll("text")
						.data(emission_upstream)
						.enter()
						.append("text")
						.text(function(d) {return d;})
						.attr("x", function(d, i) {
							return margin2+ (i+.1) * (w2 / emission_upstream.length);
						})
						.attr("y", function(d) {
							return h2 + margin2 - (d * scaley2);
						});
				   
					// x axis
					svg2.append("g")
						.attr("class", "axis")
						.attr("transform", "translate(" + margin2 + "," + (h2+margin2) + ")")
						.call(xAxis2);
					
					// y axis
					svg2.append("g")
						.attr("class", "axis")
						.attr("transform", "translate(" + margin2 + "," + (margin2) + ")")
						.call(yAxis2);
						
					// x label
					svg2.append("text")
						.attr("y", h2+margin2+30)
						.attr("x", w2/3)
						.text( "Upstream " + display.emission + " emission by route option (" +display.unit+ "/run)")
	
					<!--emission DRAWING END-->					
					
				
                    header_tag = 
                           "<table border='1'><caption><b>Onroad Emissions</b></caption>" +
                            "<tr> " + 
							'<td></td>' +
                            "<td> Unit </td>" +
                            "<td> SI/CI </td>" +
                            "<td> SI/CI </td>" +							
                            "<td> Parallel </td>" +
                            "<td> Series </td>" +
                            "<td> Battery Electric(BE) </td>" +
                            "<td> Fuel Cell Electric(FCE) </td>" +
                            "<td> Plug-in Fuel Cell Electric(PFCE) </td>" +
                            "<td> Plug-in Hybrid Electric(PHE) </td>";

                    table_html = header_tag;
                    var pollutant_row_html = {};
                    var json_data_1 = $.parseJSON(json_data["onroad_emissions"]);
                    var tech_ids = Object.keys(json_data_1);
                    // For now hardcoding the pollutants to a specific order
                    // to match the order of the columns in html table
                    // Ideally the ordering should be decided on a mapping from the
                    // tech id to the techonology name
                    tech_ids = ["unit","1", "2", "3", "4", "5", "6", "7","8"];
					var emission_onroad = []
					firstRun = true;
                    for (var tech_id_no in tech_ids) {
                        tech_id = tech_ids[tech_id_no];
                        var pollutants = Object.keys(json_data_1[tech_id]);
						//var emunit = json_data_1["unit"];
                        for (var pollutant_no in pollutants) {
                            pollutant = pollutants[pollutant_no];
                            if (!pollutant_row_html[pollutant]) {
                                pollutant_row_html[pollutant] = "<tr><td >" + pollutant + "</td>";
                            }
							if (firstRun) {
								pollutant_row_html[pollutant] += "<td>" +  json_data_1[tech_id][pollutant]  +  "</td>";
								if (pollutant == pollutant_p){
									display.unit = json_data_1[tech_id][pollutant];
								}
						//		console.log('first');
							} else { 
								pollutant_row_html[pollutant] += "<td class='number'>" +  numeral(json_data_1[tech_id][pollutant]).format('0,0.00')  +  "</td>";
								if (pollutant == pollutant_p) {
									emission_onroad.push(parseFloat(numeral(json_data_1[tech_id][pollutant]).format('0,0.00')))
									}
							//	console.log('second');
							}
                           
                        }
						firstRun = false;
                    }
                    for (var pollutant in pollutant_row_html) {
                        table_html += pollutant_row_html[pollutant] + "</tr>";
                    }
                    table_html += "</table>";
                    //console.log(table_html);
                    $("#onroad_emissions").html(table_html);
					
					<!----tailpipe atmospheric emission plot-->
					var w3 = 500;
					var h3 = 300;
					var barPadding3 = 5;
					var margin3=100;
					var dmax3=Math.max.apply(Math, emission_onroad);
					var scaley3=h3/dmax3;
	
	
					//Create SVG element
					var svg3 = d3.select("#onroad_emissions_plot")
								.append("svg")
								.attr("width", w3 + margin3*2)
								.attr("height", h3 + margin3*2);
					
					var widthScale3 = d3.scale.linear()
						.domain([0, emission_onroad.length])
						.range([0, w3]);
						
					var heightScale3 = d3.scale.linear()
						.domain([0,dmax3 ])
						.range([h3,0]);
						
					var xAxis3 = d3.svg.axis()
						.scale(widthScale3)
						.orient("bottom");
						
					var yAxis3 = d3.svg.axis()
						.scale(heightScale3)
						.orient("left")
						.ticks(5);
					
					// make bars
					svg3.selectAll("rect")
						.data(emission_onroad)
						.enter()
						.append("rect")
						.attr("class", "rect")
						.attr("fill", "teal")
						.attr("x", function(d, i) {
							return margin3 + i * (w3 / emission_onroad.length);
						})
						.attr("y", function(d) {
							return h3 + margin3 - (d * scaley3);
						})
						.attr("width", w3 / emission_onroad.length - barPadding3)
						.attr("height", function(d) {
							return d * scaley3;
						});
					
					// text above bars
					svg3.selectAll("text")
						.data(emission_onroad)
						.enter()
						.append("text")
						.text(function(d) {return d;})
						.attr("x", function(d, i) {
							return margin3+ (i+.1) * (w3 / emission_onroad.length);
						})
						.attr("y", function(d) {
							return h3 + margin3 - (d * scaley3);
						});
				   
					// x axis
					svg3.append("g")
						.attr("class", "axis")
						.attr("transform", "translate(" + margin3 + "," + (h3+margin3) + ")")
						.call(xAxis3);
					
					// y axis
					svg3.append("g")
						.attr("class", "axis")
						.attr("transform", "translate(" + margin3 + "," + (margin3) + ")")
						.call(yAxis3);
						
					// x label
					svg3.append("text")
						.attr("y", h3+margin3+30)
						.attr("x", w3/3)
						.text( "Onroad " + display.emission + " emission by route option (" +display.unit+ "/run)")
	
					<!--emission DRAWING END-->										
                    
                    header_tag = 
                           "<table border='1'><caption><b>Emissions Output Total</b></caption>" +
                            "<tr> " + 
							'<td></td>' +
                            "<td> Unit </td>" +
                            "<td> SI/CI </td>" +
                            "<td> SI/CI </td>" +							
                            "<td> Parallel </td>" +
                            "<td> Series </td>" +
                            "<td> Battery Electric(BE) </td>" +
                            "<td> Fuel Cell Electric(FCE) </td>" +
                            "<td> Plug-in Fuel Cell Electric(PFCE) </td>" +
                            "<td> Plug-in Hybrid Electric(PHE) </td>";

                    table_html = header_tag;
                    var pollutant_row_html = {};
                    var json_data_1 = $.parseJSON(json_data["emissions_output_total"]);
                    var tech_ids = Object.keys(json_data_1);
                    // For now hardcoding the pollutants to a specific order
                    // to match the order of the columns in html table
                    // Ideally the ordering should be decided on a mapping from the
                    // tech id to the techonology name
                    tech_ids = ["unit","1", "2", "3", "4", "5", "6", "7","8"];
					firstRun = true;
					var emission_route = []
                    for (var tech_id_no in tech_ids) {
                        tech_id = tech_ids[tech_id_no];
                        var pollutants = Object.keys(json_data_1[tech_id]);
						//var emunit = json_data_1["unit"];
                        for (var pollutant_no in pollutants) {
                            pollutant = pollutants[pollutant_no];
                            if (!pollutant_row_html[pollutant]) {
                                pollutant_row_html[pollutant] = "<tr><td >" + pollutant + "</td>";
                            }
							if (firstRun) {
								pollutant_row_html[pollutant] += "<td>" +  json_data_1[tech_id][pollutant]  +  "</td>";
								if (pollutant == pollutant_p){
									display.unit = json_data_1[tech_id][pollutant];
								}
						//		console.log('first');
							} else { 
								pollutant_row_html[pollutant] += "<td class='number'>" +  numeral(json_data_1[tech_id][pollutant]).format('0,0.00')  +  "</td>";
								if (pollutant == pollutant_p) {
									emission_route.push(parseFloat(numeral(json_data_1[tech_id][pollutant]).format('0,0.00')))
								}
							
							//	console.log('second');
							}
                           
                        }
						firstRun = false;
                    }
                    for (var pollutant in pollutant_row_html) {
                        table_html += pollutant_row_html[pollutant] + "</tr>";
                    }
                    table_html += "</table>";
                    //console.log(table_html);
                    $("#emissions_output_total").html(table_html);
                    
										
										
					<!----route atmospheric emission plot-->										
					var w4 = 500;
					var h4 = 300;
					var barPadding4 = 5;
					var margin4=100;
					var dmax4=Math.max.apply(Math, emission_route);
					var scaley4=h4/dmax4;
	
	
					//Create SVG element
					var svg4 = d3.select("#emissions_output_plot")
								.append("svg")
								.attr("width", w4 + margin4*2)
								.attr("height", h4 + margin4*2);
					
					var widthScale4 = d3.scale.linear()
						.domain([0, emission_route.length])
						.range([0, w4]);
						
					var heightScale4 = d3.scale.linear()
						.domain([0,dmax4 ])
						.range([h4,0]);
						
					var xAxis4 = d3.svg.axis()
						.scale(widthScale4)
						.orient("bottom");
						
					var yAxis4 = d3.svg.axis()
						.scale(heightScale4)
						.orient("left")
						.ticks(5);
					
					// make bars
					svg4.selectAll("rect")
						.data(emission_route)
						.enter()
						.append("rect")
						.attr("class", "rect")
						.attr("fill", "teal")
						.attr("x", function(d, i) {
							return margin4 + i * (w4 / emission_route.length);
						})
						.attr("y", function(d) {
							return h4 + margin4 - (d * scaley4);
						})
						.attr("width", w4 / emission_route.length - barPadding4)
						.attr("height", function(d) {
							return d * scaley4;
						});
					
					// text above bars
					svg4.selectAll("text")
						.data(emission_route)
						.enter()
						.append("text")
						.text(function(d) {return d;})
						.attr("x", function(d, i) {
							return margin4+ (i+.1) * (w4 / emission_route.length);
						})
						.attr("y", function(d) {
							return h4 + margin4 - (d * scaley4);
						});
				   
					// x axis
					svg4.append("g")
						.attr("class", "axis")
						.attr("transform", "translate(" + margin4 + "," + (h4+margin4) + ")")
						.call(xAxis4);
					
					// y axis
					svg4.append("g")
						.attr("class", "axis")
						.attr("transform", "translate(" + margin4 + "," + (margin4) + ")")
						.call(yAxis4);
						
					// x label
					svg4.append("text")
						.attr("y", h4+margin4+30)
						.attr("x", w4/3)
						.text( "Total " + display.emission + " emission by route option (" +display.unit+ "/run)")
	
					<!--emission DRAWING END-->	
                    
                    // Some code duplication here for Annual Total Emissions 
                    // Can be merged with the code right above later
                    header_tag = 
                           "<table border='1' ><caption><b>Annual Total Emissions</b></caption>" +
                            "<tr> " + 
                            "<td></td>" +
                            "<td> Unit </td>" +							
                            "<td> SI/CI </td>" +
							"<td> SI/CI </td>" +
                            "<td> Parallel </td>" +
                            "<td> Series </td>" +
                            "<td> Battery Electric(BE) </td>" +
                            "<td> Fuel Cell Electric(FCE) </td>" +
                            "<td> Plug-in Fuel Cell Electric(PFCE) </td>" +
                            "<td> Plug-in Hybrid Electric(PHE) </td>";

                    table_html = header_tag;
                    var pollutant_row_html = {};
                    var json_data_1 = $.parseJSON(json_data["annual_total_emissions"]);
                    var tech_ids = Object.keys(json_data_1);
					var emission_annual = [];
                    // For now hardcoding the pollutants to a specific order
                    // to match the order of the columns in html table
                    // Ideally the ordering should be decided on a mapping from the
                    // tech id to the techonology name
                    tech_ids = ["unit","1", "2", "3", "4", "5", "6", "7","8"];
					firstRun = true;
                    for (var tech_id_no in tech_ids) {
                        tech_id = tech_ids[tech_id_no];
                        var pollutants = Object.keys(json_data_1[tech_id]);
						//var emunit = json_data_1["unit"];
                        for (var pollutant_no in pollutants) {
                            pollutant = pollutants[pollutant_no];
                            if (!pollutant_row_html[pollutant]) {
                                pollutant_row_html[pollutant] = "<tr><td >" + pollutant + "</td>";
                            }
							if (firstRun) {
								pollutant_row_html[pollutant] += "<td>" +  json_data_1[tech_id][pollutant]  +  "</td>";
						//		console.log('first');
							} else { 
								pollutant_row_html[pollutant] += "<td class='number'>" +  numeral(json_data_1[tech_id][pollutant]).format('0,0.00')  +  "</td>";
							//	console.log('second');
								if (pollutant_no == 0) {
									emission_annual.push(parseFloat(numeral(json_data_1[tech_id][pollutant]).format('0,0.00')))
								}
							}
                           
                        }
						firstRun = false;
                    }
                    for (var pollutant in pollutant_row_html) {
                        table_html += pollutant_row_html[pollutant] + "</tr>";
                    }
                    //console.log(table_html);
                    table_html+= "</table>";
					console.log(emission_annual);
                    $("#annual_total_emissions").html(table_html);
					<!----annual atmospheric emission plot-->										
/*					var w5 = 500;
					var h5 = 300;
					var barPadding5 = 5;
					var margin5=100;
					var dmax5=Math.max.apply(Math, emission_annual);
					var scaley5=h5/dmax5;
	
	
					//Create SVG element
					var svg5 = d3.select("#annual_total_plot")
								.append("svg")
								.attr("width", w5 + margin5*2)
								.attr("height", h5 + margin5*2);
					
					var widthScale5 = d3.scale.linear()
						.domain([0, emission_route.length])
						.range([0, w5]);
						
					var heightScale5 = d3.scale.linear()
						.domain([0,dmax5 ])
						.range([h5,0]);
						
					var xAxis5 = d3.svg.axis()
						.scale(widthScale5)
						.orient("bottom");
						
					var yAxis5 = d3.svg.axis()
						.scale(heightScale5)
						.orient("left")
						.ticks(5);
					
					// make bars
					svg5.selectAll("rect")
						.data(emission_annual)
						.enter()
						.append("rect")
						.attr("class", "rect")
						.attr("fill", "teal")
						.attr("x", function(d, i) {
							return margin5 + i * (w5 / emission_annual.length);
						})
						.attr("y", function(d) {
							return h5 + margin5 - (d * scaley5);
						})
						.attr("width", w5 / emission_annual.length - barPadding5)
						.attr("height", function(d) {
							return d * scaley5;
						});
					
					// text above bars
					svg5.selectAll("text")
						.data(emission_annual)
						.enter()
						.append("text")
						.text(function(d) {return d3.format(".1e")(d);})
						.attr("x", function(d, i) {
							return margin5+ (i+.1) * (w5 / emission_annual.length);
						})
						.attr("y", function(d) {
							return h5 + margin5 - (d * scaley5);
						});
				   
					// x axis
					svg5.append("g")
						.attr("class", "axis")
						.attr("transform", "translate(" + margin5 + "," + (h5+margin5) + ")")
						.call(xAxis4);
					
					// y axis
					svg5.append("g")
						.attr("class", "axis")
						.attr("transform", "translate(" + margin5 + "," + (margin5) + ")")
						.call(yAxis5);
						
					// x label
					svg5.append("text")
						.attr("y", h5+margin5+30)
						.attr("x", w5/2)
						.text("annual atmospheric emission by route option (Kg)")
	
					<!--emission DRAWING END-->						
					*/
                    
                }); 
			}
    );
  </script>
</html>